<html><head><base href="." /><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1" name="viewport"><style>
body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #008080;
    height: 100vh;
    overflow: hidden;
}

.loading-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    z-index: 9999;
}

.loading-logo {
    margin-bottom: 20px;
}

.loading-bar-container {
    width: 300px;
    height: 20px;
    background: #333;
    border: 2px solid #444;
    border-radius: 10px;
    overflow: hidden;
}

.loading-bar {
    width: 0%;
    height: 100%;
    background: #008080;
    transition: width 3s ease-in-out;
}

.loading-text {
    margin-top: 10px;
    font-size: 18px;
}

.desktop {
    height: 100vh;
    position: relative;
    display: none;
}

.taskbar {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 40px;
    background: #c0c0c0;
    border-top: 2px solid #ffffff;
    display: flex;
    align-items: center;
    padding: 0 10px;
    box-shadow: inset -1px -1px #0a0a0a,inset 1px 1px #dfdfdf;
}

.start-button {
    padding: 5px 15px;
    margin-right: 10px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    cursor: pointer;
    display: flex;
    align-items: center;
    font-weight: bold;
}

.start-button:active {
    border-style: inset;
}

.start-menu {
    position: fixed;
    bottom: 40px; /* Height of taskbar */
    left: 0;
    width: 200px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    display: none;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    z-index: 9999;
}

.start-menu-item {
    padding: 8px 15px;
    cursor: pointer;
    border-bottom: 1px solid #808080;
}

.start-menu-item:hover {
    background: #000080;
    color: white;
}

.window {
    position: absolute;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    min-width: 200px;
    min-height: 150px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    resize: both;
    overflow: auto;
}

.title-bar {
    background: #000080;
    color: white;
    padding: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: move;
}

.window-buttons {
    display: flex;
    gap: 2px;
}

.close-btn, .minimize-btn {
    background: #c0c0c0;
    border: 1px outset #ffffff;
    padding: 2px 5px;
    cursor: pointer;
}

.window-content {
    padding: 10px;
    max-height: 80vh;
    overflow: auto;
}

.desktop-icon {
    width: 70px;
    text-align: center;
    color: white;
    margin: 10px;
    cursor: pointer;
}

.icon-grid {
    display: flex;
    flex-wrap: wrap;
    padding: 20px;
}

.clock {
    margin-left: auto;
    padding: 5px 10px;
    background: #c0c0c0;
    border: 2px inset #ffffff;
}

.minimized {
    display: none;
}

#taskbar-items {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    overflow-x: auto;
}

.taskbar-item {
    padding: 3px 10px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    margin-right: 5px;
    cursor: pointer;
    white-space: nowrap;
    min-width: 100px;
    max-width: 200px;
}

.taskbar-item.active {
    border-style: inset;
}

.settings-group {
    margin-bottom: 15px;
}

.settings-group label {
    display: block;
    margin-bottom: 5px;
}

.color-picker {
    margin-bottom: 10px;
}

.calculator-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 5px;
    padding: 10px;
}

.calculator-screen {
    grid-column: span 4;
    background: #fff;
    border: 2px inset #ffffff;
    padding: 10px;
    text-align: right;
    margin-bottom: 10px;
    font-family: monospace;
    font-size: 20px;
}

.calculator-button {
    padding: 10px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    cursor: pointer;
    font-size: 14px;
}

.calculator-button:active {
    border-style: inset;
}

.calculator-button.span-2 {
    grid-column: span 2;
}

.browser-toolbar {
    display: flex;
    gap: 5px;
    padding: 5px;
    background: #f0f0f0;
    border-bottom: 1px solid #ccc;
}

.browser-toolbar input {
    flex: 1;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 3px;
}

.browser-toolbar button {
    padding: 5px 10px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    cursor: pointer;
}

.browser-toolbar button:active {
    border-style: inset;
}

.browser-content {
    width: 100%;
    height: 400px;
    border: none;
}

/* Add Paint-specific styles */
.paint-toolbar {
    display: flex;
    gap: 5px;
    padding: 5px;
    background: #f0f0f0;
    border-bottom: 1px solid #ccc;
}

.paint-tools {
    display: flex;
    gap: 5px;
}

.paint-tool {
    padding: 5px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    cursor: pointer;
    min-width: 30px;
    text-align: center;
}

.paint-tool.active {
    border-style: inset;
    background: #a0a0a0;
}

.paint-colors {
    display: flex;
    gap: 5px;
    margin-left: 10px;
}

.color-picker-paint {
    width: 30px;
    height: 30px;
    padding: 0;
    border: none;
}

.size-selector {
    width: 60px;
}

.paint-canvas {
    background: #ffffff;
    cursor: crosshair;
    display: block;
    margin: 0 auto;
    max-width: 100%;
}

.text-editor-toolbar {
    padding: 5px;
    background: #f0f0f0;
    border-bottom: 1px solid #ccc;
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
}

.text-editor-toolbar button {
    padding: 5px 10px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
}

.text-editor-toolbar button:active {
    border-style: inset;
}

.text-editor-toolbar select {
    padding: 3px;
    border: 1px solid #999;
}

.text-editor-content {
    padding: 10px;
    background: white;
    border: 1px solid #ccc;
    min-height: 300px;
    margin: 5px;
}

[contenteditable="true"] {
    outline: none;
}

.error-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #c0c0c0;
    border: 2px outset #ffffff;
    padding: 10px;
    width: 300px;
    z-index: 10000;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
}

.error-title {
    background: #000080;
    color: white;
    padding: 5px;
    margin: -10px -10px 10px -10px;
}

.error-content {
    padding: 20px 10px;
    text-align: center;
}

.error-button {
    display: block;
    margin: 10px auto;
    padding: 5px 20px;
    background: #c0c0c0;
    border: 2px outset #ffffff;
    cursor: pointer;
}

.error-button:active {
    border-style: inset;
}
</style></head><body>
<div class="loading-screen" id="loadingScreen">
    <div class="loading-logo">
        <svg width="100" height="100" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#008080" stroke-width="5"/>
            <text x="50" y="55" text-anchor="middle" fill="#008080" font-size="14">Seliq Bob</text>
        </svg>
    </div>
    <div class="loading-bar-container">
        <div class="loading-bar" id="loadingBar"></div>
    </div>
    <div class="loading-text">Loading Seliq Bob 1.0...</div>
</div>

<div class="desktop">
    <div class="icon-grid">
        <div class="desktop-icon" ondblclick="createWindow('Notepad')">
            <svg width="32" height="32" viewBox="0 0 32 32">
                <rect x="6" y="4" width="20" height="24" fill="#ffffff" stroke="#000"/>
                <line x1="10" y1="8" x2="22" y2="8" stroke="#000"/>
                <line x1="10" y1="12" x2="22" y2="12" stroke="#000"/>
                <line x1="10" y1="16" x2="22" y2="16" stroke="#000"/>
            </svg>
            <div>Notepad</div>
        </div>
        <div class="desktop-icon" ondblclick="createWindow('Settings')">
            <svg width="32" height="32" viewBox="0 0 32 32">
                <circle cx="16" cy="16" r="12" fill="#ffffff" stroke="#000"/>
                <path d="M16 8 L16 24 M8 16 L24 16" stroke="#000" stroke-width="2"/>
            </svg>
            <div>Settings</div>
        </div>
        <div class="desktop-icon" ondblclick="createWindow('Calculator')">
            <svg width="32" height="32" viewBox="0 0 32 32">
                <rect x="4" y="2" width="24" height="28" fill="#f0f0f0" stroke="#000"/>
                <rect x="6" y="4" width="20" height="6" fill="#fff" stroke="#000"/>
                <rect x="7" y="12" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="14" y="12" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="21" y="12" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="7" y="18" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="14" y="18" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="21" y="18" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="7" y="24" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="14" y="24" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
                <rect x="21" y="24" width="4" height="4" fill="#d0d0d0" stroke="#808080"/>
            </svg>
            <div>Calculator</div>
        </div>
        <div class="desktop-icon" ondblclick="createWindow('SBrow')">
            <svg width="32" height="32" viewBox="0 0 32 32">
                <circle cx="16" cy="16" r="14" fill="#4285f4" stroke="#2965d6"/>
                <circle cx="16" cy="16" r="6" fill="white"/>
                <path d="M16 10 A6 6 0 0 1 22 16" stroke="#ea4335" stroke-width="2"/>
                <path d="M16 22 A6 6 0 0 1 10 16" stroke="#34a853" stroke-width="2"/>
                <path d="M10 16 A6 6 0 0 1 16 10" stroke="#fbbc05" stroke-width="2"/>
                <path d="M22 16 A6 6 0 0 1 16 22" stroke="#4285f4" stroke-width="2"/>
            </svg>
            <div>SBrow</div>
        </div>
        <div class="desktop-icon" ondblclick="createWindow('Paint')">
            <svg width="32" height="32" viewBox="0 0 32 32">
                <rect x="4" y="4" width="24" height="24" fill="#ffffff" stroke="#000"/>
                <path d="M8 20 L12 16 L18 22 L24 12" stroke="#ff0000" stroke-width="2"/>
                <circle cx="20" cy="8" r="3" fill="#0000ff"/>
                <rect x="6" y="22" width="12" height="4" fill="#008000"/>
            </svg>
            <div>Paint</div>
        </div>
        <div class="desktop-icon" ondblclick="createWindow('TXTEDT')">
            <svg width="32" height="32" viewBox="0 0 32 32">
                <rect x="4" y="4" width="24" height="24" fill="#ffffff" stroke="#000"/>
                <line x1="8" y1="8" x2="24" y2="8" stroke="#000" stroke-width="2"/>
                <line x1="8" y1="13" x2="20" y2="13" stroke="#000"/>
                <line x1="8" y1="18" x2="24" y2="18" stroke="#000"/>
                <line x1="8" y1="23" x2="16" y2="23" stroke="#000"/>
            </svg>
            <div>TXTEDT</div>
        </div>
    </div>
    <div class="taskbar">
        <div class="start-button" onclick="toggleStartMenu()">Start</div>
        <div id="startMenu" class="start-menu">
            <div class="start-menu-item" onclick="showError()">Programs</div>
            <div class="start-menu-item" onclick="showError()">Documents</div>
            <div class="start-menu-item" onclick="createWindow('Settings')">Settings</div>
            <div class="start-menu-item" onclick="showError()">Find</div>
            <div class="start-menu-item" onclick="showError()">Help</div>
            <div class="start-menu-item" onclick="showError()">Run...</div>
            <div class="start-menu-item" onclick="shutDown()">Shut Down...</div>
        </div>
        <div id="taskbar-items"></div>
        <div class="clock" id="clock"></div>
    </div>
</div>

<script>
let zIndex = 1000;
let windows = [];
let windowCount = 0;

function updateClock() {
    const clock = document.getElementById('clock');
    const now = new Date();
    clock.textContent = now.toLocaleTimeString();
}

setInterval(updateClock, 1000);
updateClock();

function applySettings(setting, value) {
    switch(setting) {
        case 'background':
            document.body.style.background = value;
            const bgInputs = document.querySelectorAll('.color-picker[data-setting="background"]');
            bgInputs.forEach(input => input.value = value);
            break;
        case 'taskbar':
            document.querySelector('.taskbar').style.background = value;
            const taskbarInputs = document.querySelectorAll('.color-picker[data-setting="taskbar"]');
            taskbarInputs.forEach(input => input.value = value);
            break;
    }
    localStorage.setItem(setting, value);
}

function loadSavedSettings() {
    const savedBackground = localStorage.getItem('background');
    const savedTaskbar = localStorage.getItem('taskbar');
    
    if (savedBackground) document.body.style.background = savedBackground;
    if (savedTaskbar) document.querySelector('.taskbar').style.background = savedTaskbar;
}

function createWindow(title) {
    const windowId = 'window-' + windowCount++;
    const window = document.createElement('div');
    window.className = 'window';
    window.id = windowId;
    window.style.left = Math.random() * (window.innerWidth - 300) + 'px';
    window.style.top = Math.random() * (window.innerHeight - 200) + 'px';
    window.style.zIndex = zIndex++;

    window.innerHTML = `
        <div class="title-bar">
            <div>${title}</div>
            <div class="window-buttons">
                <button class="minimize-btn" onclick="minimizeWindow('${windowId}')">_</button>
                <button class="close-btn" onclick="closeWindow('${windowId}')">×</button>
            </div>
        </div>
        <div class="window-content">
            ${getWindowContent(title)}
        </div>
    `;

    document.querySelector('.desktop').appendChild(window);
    windows.push({
        id: windowId,
        title: title,
        element: window
    });
    createTaskbarItem(windowId, title);
    makeDraggable(window);

    // Add Paint functionality
    if (title === 'Paint') {
        initializePaint(window);
    }
}

function getWindowContent(title) {
    switch(title) {
        case 'Notepad':
            return `<textarea style="width: 100%; height: 200px; resize: none;"></textarea>`;
        case 'Settings':
            const background = document.body.style.background || '#008080';
            const taskbar = document.querySelector('.taskbar').style.background || '#c0c0c0';
            return `
                <div class="settings-group">
                    <label>Background Color:</label>
                    <input type="color" class="color-picker" data-setting="background" 
                           value="${background}"
                           onchange="applySettings('background', this.value)">
                </div>
                <div class="settings-group">
                    <label>Taskbar Color:</label>
                    <input type="color" class="color-picker" data-setting="taskbar"
                           value="${taskbar}"
                           onchange="applySettings('taskbar', this.value)">
                </div>
            `;
        case 'Calculator':
            return `
                <div class="calculator-grid">
                    <div class="calculator-screen" id="calc-screen">0</div>
                    <button class="calculator-button" onclick="calculatorClear()">C</button>
                    <button class="calculator-button" onclick="calculatorDelete()">←</button>
                    <button class="calculator-button" onclick="calculatorOperation('/')">/</button>
                    <button class="calculator-button" onclick="calculatorOperation('*')">×</button>
                    <button class="calculator-button" onclick="calculatorInput('7')">7</button>
                    <button class="calculator-button" onclick="calculatorInput('8')">8</button>
                    <button class="calculator-button" onclick="calculatorInput('9')">9</button>
                    <button class="calculator-button" onclick="calculatorOperation('-')">-</button>
                    <button class="calculator-button" onclick="calculatorInput('4')">4</button>
                    <button class="calculator-button" onclick="calculatorInput('5')">5</button>
                    <button class="calculator-button" onclick="calculatorInput('6')">6</button>
                    <button class="calculator-button" onclick="calculatorOperation('+')">+</button>
                    <button class="calculator-button" onclick="calculatorInput('1')">1</button>
                    <button class="calculator-button" onclick="calculatorInput('2')">2</button>
                    <button class="calculator-button" onclick="calculatorInput('3')">3</button>
                    <button class="calculator-button span-2" onclick="calculatorCalculate()">=</button>
                    <button class="calculator-button span-2" onclick="calculatorInput('0')">0</button>
                    <button class="calculator-button" onclick="calculatorInput('.')">.</button>
                </div>
            `;
        case 'SBrow':
            return `
                <div class="browser-toolbar">
                    <button onclick="browserBack(this)">←</button>
                    <button onclick="browserForward(this)">→</button>
                    <button onclick="browserRefresh(this)">↻</button>
                    <input type="text" class="url-bar" placeholder="Enter URL" onkeydown="if(event.key === 'Enter') browserNavigate(this)">
                    <button onclick="browserGo(this)">Go</button>
                </div>
                <iframe class="browser-content" src="https://jelly-stone-hardboard.glitch.me"></iframe>
            `;
        case 'Paint':
            return `
                <div class="paint-toolbar">
                    <div class="paint-tools">
                        <button class="paint-tool active" data-tool="brush">🖌️</button>
                        <button class="paint-tool" data-tool="eraser">⌫</button>
                        <input type="number" class="size-selector" value="5" min="1" max="50" title="Brush Size">
                    </div>
                    <div class="paint-colors">
                        <input type="color" class="color-picker-paint" value="#000000">
                    </div>
                    <button class="paint-tool" onclick="clearCanvas(this)">Clear</button>
                </div>
                <canvas class="paint-canvas"></canvas>
            `;
        case 'TXTEDT':
            return `
                <div class="text-editor-toolbar">
                    <select onchange="formatText('fontName', this.value)">
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                    </select>
                    <select onchange="formatText('fontSize', this.value)">
                        ${[8,10,12,14,16,18,20,24,28,32,36,48].map(size => 
                            `<option value="${size}px">${size}</option>`
                        ).join('')}
                    </select>
                    <button onclick="formatText('bold')"><strong>B</strong></button>
                    <button onclick="formatText('italic')"><em>I</em></button>
                    <button onclick="formatText('underline')"><u>U</u></button>
                    <button onclick="formatText('strikeThrough')"><strike>S</strike></button>
                    <button onclick="formatText('justifyLeft')">⬱</button>
                    <button onclick="formatText('justifyCenter')">≣</button>
                    <button onclick="formatText('justifyRight')">⬲</button>
                    <input type="color" onchange="formatText('foreColor', this.value)" title="Text Color">
                    <button onclick="formatText('insertUnorderedList')">• List</button>
                    <button onclick="formatText('insertOrderedList')">1. List</button>
                </div>
                <div class="text-editor-content" contenteditable="true">
                    Type your text here...
                </div>
            `;
        default:
            return `Window content for ${title}`;
    }
}

function createTaskbarItem(windowId, title) {
    const taskbarItem = document.createElement('div');
    taskbarItem.className = 'taskbar-item';
    taskbarItem.textContent = title;
    taskbarItem.setAttribute('data-window-id', windowId);
    taskbarItem.onclick = function() {
        const windowId = this.getAttribute('data-window-id');
        const windowElement = document.getElementById(windowId);
        if (windowElement) {
            toggleWindow(windowId);
        }
    };
    document.getElementById('taskbar-items').appendChild(taskbarItem);
}

function minimizeWindow(windowId) {
    const window = document.getElementById(windowId);
    if (window) {
        window.classList.add('minimized');
    }
}

function toggleWindow(windowId) {
    const window = document.getElementById(windowId);
    if (window) {
        if (window.classList.contains('minimized')) {
            window.classList.remove('minimized');
            window.style.zIndex = zIndex++;
        } else {
            window.classList.add('minimized');
        }
    }
}

function closeWindow(windowId) {
    const window = document.getElementById(windowId);
    if (window) {
        window.remove();
        windows = windows.filter(w => w.id !== windowId);
        const taskbarItems = document.getElementById('taskbar-items');
        const taskbarItem = taskbarItems.querySelector(`[data-window-id="${windowId}"]`);
        if (taskbarItem) {
            taskbarItem.remove();
        }
    }
}

function makeDraggable(element) {
    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    element.querySelector('.title-bar').onmousedown = dragMouseDown;

    function dragMouseDown(e) {
        e.preventDefault();
        element.style.zIndex = zIndex++;
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        element.style.top = (element.offsetTop - pos2) + "px";
        element.style.left = (element.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
    }
}

let calculatorState = {
    currentValue: '0',
    previousValue: null,
    operation: null,
    newNumber: true
};

function updateCalculatorDisplay(windowId) {
    const screen = document.querySelector(`#${windowId} #calc-screen`);
    if (screen) {
        screen.textContent = calculatorState.currentValue;
    }
}

function calculatorInput(digit) {
    const activeCalc = document.querySelector('.window:not(.minimized) #calc-screen');
    if (!activeCalc) return;
    const windowId = activeCalc.closest('.window').id;
    
    if (calculatorState.newNumber) {
        calculatorState.currentValue = digit;
        calculatorState.newNumber = false;
    } else {
        if (digit === '.' && calculatorState.currentValue.includes('.')) return;
        calculatorState.currentValue = calculatorState.currentValue + digit;
    }
    updateCalculatorDisplay(windowId);
}

function calculatorOperation(op) {
    const activeCalc = document.querySelector('.window:not(.minimized) #calc-screen');
    if (!activeCalc) return;
    const windowId = activeCalc.closest('.window').id;
    
    calculatorState.previousValue = parseFloat(calculatorState.currentValue);
    calculatorState.operation = op;
    calculatorState.newNumber = true;
}

function calculatorCalculate() {
    const activeCalc = document.querySelector('.window:not(.minimized) #calc-screen');
    if (!activeCalc) return;
    const windowId = activeCalc.closest('.window').id;
    
    if (calculatorState.previousValue === null || calculatorState.operation === null) return;
    
    const current = parseFloat(calculatorState.currentValue);
    let result;
    
    switch(calculatorState.operation) {
        case '+':
            result = calculatorState.previousValue + current;
            break;
        case '-':
            result = calculatorState.previousValue - current;
            break;
        case '*':
            result = calculatorState.previousValue * current;
            break;
        case '/':
            result = calculatorState.previousValue / current;
            break;
    }
    
    calculatorState.currentValue = result.toString();
    calculatorState.previousValue = null;
    calculatorState.operation = null;
    calculatorState.newNumber = true;
    updateCalculatorDisplay(windowId);
}

function calculatorClear() {
    const activeCalc = document.querySelector('.window:not(.minimized) #calc-screen');
    if (!activeCalc) return;
    const windowId = activeCalc.closest('.window').id;
    
    calculatorState.currentValue = '0';
    calculatorState.previousValue = null;
    calculatorState.operation = null;
    calculatorState.newNumber = true;
    updateCalculatorDisplay(windowId);
}

function calculatorDelete() {
    const activeCalc = document.querySelector('.window:not(.minimized) #calc-screen');
    if (!activeCalc) return;
    const windowId = activeCalc.closest('.window').id;
    
    if (calculatorState.currentValue.length > 1) {
        calculatorState.currentValue = calculatorState.currentValue.slice(0, -1);
    } else {
        calculatorState.currentValue = '0';
        calculatorState.newNumber = true;
    }
    updateCalculatorDisplay(windowId);
}

function browserNavigate(input) {
    const iframe = input.closest('.window-content').querySelector('iframe');
    let url = input.value;
    
    // Add https if no protocol specified
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        url = 'https://' + url;
    }
    
    try {
        iframe.src = url;
    } catch (e) {
        console.error('Navigation failed:', e);
    }
}

function browserGo(button) {
    const input = button.previousElementSibling;
    browserNavigate(input);
}

function browserBack(button) {
    const iframe = button.closest('.window-content').querySelector('iframe');
    try {
        iframe.contentWindow.history.back();
    } catch (e) {
        console.error('Cannot go back:', e);
    }
}

function browserForward(button) {
    const iframe = button.closest('.window-content').querySelector('iframe');
    try {
        iframe.contentWindow.history.forward();
    } catch (e) {
        console.error('Cannot go forward:', e);
    }
}

function browserRefresh(button) {
    const iframe = button.closest('.window-content').querySelector('iframe');
    try {
        iframe.contentWindow.location.reload();
    } catch (e) {
        console.error('Cannot refresh:', e);
    }
}

function initializePaint(windowElement) {
    const canvas = windowElement.querySelector('.paint-canvas');
    const ctx = canvas.getContext('2d');
    const tools = windowElement.querySelectorAll('.paint-tool');
    let isDrawing = false;
    let currentTool = 'brush';
    let startX, startY;
    let lastValidCanvas = null;
    
    // Set fixed dimensions for the canvas
    function resizeCanvas() {
        const content = windowElement.querySelector('.window-content');
        const toolbar = windowElement.querySelector('.paint-toolbar');
        
        const FIXED_WIDTH = 800;
        const FIXED_HEIGHT = 600;
        
        requestAnimationFrame(() => {
            // Only resize if dimensions actually changed and are valid
            if (canvas.width !== FIXED_WIDTH || canvas.height !== FIXED_HEIGHT) {
                // Store current canvas content
                if (canvas.width > 0 && canvas.height > 0) {
                    lastValidCanvas = document.createElement('canvas');
                    lastValidCanvas.width = canvas.width;
                    lastValidCanvas.height = canvas.height;
                    const tempCtx = lastValidCanvas.getContext('2d');
                    tempCtx.drawImage(canvas, 0, 0);
                }
                
                // Set fixed dimensions
                canvas.width = FIXED_WIDTH;
                canvas.height = FIXED_HEIGHT;
                
                // Fill with white background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, FIXED_WIDTH, FIXED_HEIGHT);
                
                // Restore previous content if available
                if (lastValidCanvas) {
                    ctx.drawImage(lastValidCanvas, 0, 0);
                }
            }
        });
    }
    
    // Initialize canvas with a small delay to ensure window is properly sized
    setTimeout(() => {
        resizeCanvas();
    }, 100);

    // Throttled resize observer
    let resizeTimeout;
    const resizeObserver = new ResizeObserver(() => {
        if (!resizeTimeout) {
            resizeTimeout = setTimeout(() => {
                resizeCanvas();
                resizeTimeout = null;
            }, 100);
        }
    });
    
    // Observe the window content
    resizeObserver.observe(windowElement.querySelector('.window-content'));

    // Add event listeners for painting functionality
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    function startDrawing(e) {
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        startX = e.clientX - rect.left;
        startY = e.clientY - rect.top;
        
        // For brush tool, start the path
        if (currentTool === 'brush') {
            ctx.beginPath();
            ctx.moveTo(startX, startY);
        }
    }

    function draw(e) {
        if (!isDrawing) return;
        
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const colorPicker = windowElement.querySelector('.color-picker-paint');
        const sizeSelector = windowElement.querySelector('.size-selector');
        const color = colorPicker.value;
        const size = parseInt(sizeSelector.value);
        
        ctx.lineWidth = size;
        ctx.lineCap = 'round';
        ctx.strokeStyle = color;
        
        switch (currentTool) {
            case 'brush':
                ctx.lineTo(x, y);
                ctx.stroke();
                break;
            case 'eraser':
                ctx.strokeStyle = '#ffffff';
                ctx.lineTo(x, y);
                ctx.stroke();
                break;
        }
    }

    function stopDrawing() {
        isDrawing = false;
        ctx.beginPath();
    }

    // Cleanup function
    const cleanup = () => {
        resizeObserver.disconnect();
        if (resizeTimeout) {
            clearTimeout(resizeTimeout);
        }
        canvas.removeEventListener('mousedown', startDrawing);
        canvas.removeEventListener('mousemove', draw);
        canvas.removeEventListener('mouseup', stopDrawing);
        canvas.removeEventListener('mouseout', stopDrawing);
    };

    // Add cleanup when window is closed
    windowElement.addEventListener('remove', cleanup);

    // Tool selection
    tools.forEach(tool => {
        tool.addEventListener('click', () => {
            if (tool.dataset.tool) {
                tools.forEach(t => t.classList.remove('active'));
                tool.classList.add('active');
                currentTool = tool.dataset.tool;
            }
        });
    });
}

// Add clearCanvas function
function clearCanvas(button) {
    const canvas = button.closest('.window-content').querySelector('.paint-canvas');
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// Add formatText function
function formatText(command, value = null) {
    document.execCommand(command, false, value);
    const editor = document.querySelector('.text-editor-content');
    if (editor) {
        editor.focus();
    }
}

function toggleStartMenu() {
    const startMenu = document.getElementById('startMenu');
    if (startMenu.style.display === 'block') {
        startMenu.style.display = 'none';
    } else {
        startMenu.innerHTML = getStartMenuHTML();
        startMenu.style.display = 'block';
    }
}

function getStartMenuHTML() {
    return `
        <div class="start-menu-item" onclick="showError()">Programs</div>
        <div class="start-menu-item" onclick="showError()">Documents</div>
        <div class="start-menu-item" onclick="createWindow('Settings')">Settings</div>
        <div class="start-menu-item" onclick="showError()">Find</div>
        <div class="start-menu-item" onclick="showError()">Help</div>
        <div class="start-menu-item" onclick="showError()">Run...</div>
        <div class="start-menu-item" onclick="shutDown()">Shut Down...</div>
    `;
}

// Add shutdown function
function shutDown() {
    // Fade to black
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.width = '100%';
    overlay.style.height = '100%';
    overlay.style.background = '#000';
    overlay.style.opacity = '0';
    overlay.style.transition = 'opacity 1s';
    overlay.style.zIndex = '99999';
    document.body.appendChild(overlay);

    // Fade in the black overlay
    setTimeout(() => {
        overlay.style.opacity = '1';
    }, 100);
}

// Add showError function
function showError() {
    const errorWindow = document.createElement('div');
    errorWindow.className = 'error-window';
    errorWindow.innerHTML = `
        <div class="error-title">Hello User!</div>
        <div class="error-content">
            This is still in W.I.P!!!!! so coming soon....
        </div>
        <button class="error-button" onclick="this.parentElement.remove()">OK</button>
    `;
    document.body.appendChild(errorWindow);
}

document.addEventListener('click', (e) => {
    const startMenu = document.getElementById('startMenu');
    const startButton = document.querySelector('.start-button');
    
    if (!startMenu.contains(e.target) && !startButton.contains(e.target)) {
        startMenu.style.display = 'none';
    }
});

windows.forEach(window => {
    if (window.element) {
        window.element.addEventListener('mousedown', () => {
            window.element.style.zIndex = zIndex++;
        });
    }
});

loadSavedSettings();

window.addEventListener('DOMContentLoaded', () => {
    const loadingBar = document.getElementById('loadingBar');
    const loadingScreen = document.getElementById('loadingScreen');
    const desktop = document.querySelector('.desktop');

    // Start loading animation
    setTimeout(() => {
        loadingBar.style.width = '100%';
    }, 100);

    // Hide loading screen after animation
    setTimeout(() => {
        loadingScreen.style.opacity = '0';
        loadingScreen.style.transition = 'opacity 0.5s';
        desktop.style.display = 'block';
        setTimeout(() => {
            loadingScreen.style.display = 'none';
        }, 500);
    }, 3000);
});
</script></body></html>